'use strict';(function(){class Scripty extends HTMLElement{static get observedAttributes(){return['packages','oncomplete','locals']}get packages(){return this.getAttribute('packages')}get oncomplete(){return this._oncomplete}get locals(){return this.getAttribute('locals')}get apiBase(){return'http://api.jsdelivr.com/v1/jsdelivr/libraries'}get jsdelivr(){return'https://cdn.jsdelivr.net'}set package(a){this._package=a}constructor(){super(),this._counter=0,this._packages=[],this._package={},this._oncomplete=void 0,this._locals=void 0,document.addEventListener('DOMContentLoaded',()=>this.windowLoaded()),console.info('Scripty initilized')}attributeChangedCallback(a,b,c){if(this._counter+=1,'packages'===a&&null!==c||('oncomplete'===a&&null!==c?this._oncomplete=c:'locals'==a&&null!==c&&(this._locals=c)),this._counter===this.attributes.length){let d=this.preparePackages(this.packages);this.loadPackages(d)}}preparePackages(a){return a.split(',').forEach(b=>{let c=b.split('@');this._packages.push({name:c[0],version:c[1]})}),this._packages}loadPackages(a){let b=[],c=[];a.forEach(d=>{this.package=d;let e=new Promise((f,g)=>{let h=this.packageUrl(d);c.push(this.appendScript(h)),f(d)});b.push(e)}),Promise.all(b).then(d=>{d.forEach(e=>console.info(`${e.name}@${e.version}`)),Promise.all(c).then(()=>{this.locals.split(',').forEach(e=>this.appendScript(this.locals))})})}packageUrl(a){if(a.version)this.getPackageVersion(a.name,a.version).then(b=>{if(b){let c=`${this.jsdelivr}/${a.name}/${b.version}/${b.mainfile}`;resolve(c)}else console.warn(`package is missing for ${a.name}@${a.version}`),resolve(void 0)});else{let b=this.getPackageInfo(a.name)[0];return b?(a.version=b.lastversion,`${this.jsdelivr}/${b.name}/${b.lastversion}/${b.mainfile}`):void 0}}getPackageInfo(a){a=a.replace(' ','*');let b=`${this.apiBase}?name=${a}&fields=name,lastversion,mainfile`;return JSON.parse(this.httpsync(b))}getPackageVersion(a,b){let c=new Promise((d,e)=>{let f=`${this.apiBase}?name=${a}&fields=assets`;fetch(f).then(function(g){return g.json()}).then(function(g){g[0].assets.forEach(h=>{b===h.version&&(console.info(`Found matching version for ${a}@${h.version}`),d(h))}),d(void 0)})});return c}appendScript(filename){let pr=new Promise((resolve,reject)=>{filename&&eval(this.httpsync(filename)),resolve(filename)});return pr}httpsync(a){var b=new XMLHttpRequest;return b.open('GET',a,!1),b.send(''),b.responseText}callback(a,b){a()}windowLoaded(){console.info('On complete fired'),this.oncomplete&&eval(this.oncomplete)}}customElements.define('script-y',Scripty)})();