'use strict';(function(){class Scripty extends HTMLElement{static get observedAttributes(){return['packages','oncomplete','locals']}get packages(){return this.getAttribute('packages')}get oncomplete(){return this.getAttribute('oncomplete')}get locals(){return this.getAttribute('locals')}get apiBase(){return'http://api.jsdelivr.com/v1/jsdelivr/libraries'}get jsdelivr(){return'https://cdn.jsdelivr.net'}constructor(){super(),this._counter=0,this._packages=[],this._locals=void 0,document.addEventListener('DOMContentLoaded',()=>this.windowLoaded()),console.info('Scripty initilized')}attributeChangedCallback(a,b,c){if(this._counter+=1,this._counter===this.attributes.length){let d=this.preparePackages(this.packages);this.loadPackages(d)}}preparePackages(a){return a.split(',').forEach(b=>{let c=b.split('@');this._packages.push({name:c[0],version:c[1]})}),this._packages}loadPackages(a){let b=[],c=[];a.forEach(d=>{let e=new Promise((f,g)=>{let h=this.packageUrl(d);c.push(this.appendScript(h)),f(d)});b.push(e)}),Promise.all(b).then(d=>{d.forEach(e=>console.info(`${e.name}@${e.version}`)),Promise.all(c).then(()=>{this.locals&&this.locals.split(',').forEach(e=>this.appendScript(this.locals))})})}packageUrl(a){if(a.name=a.name.replace(' ','*'),a.version){let b=this.getPackageVersion(a.name,a.version);if(b)return`${this.jsdelivr}/${b.name}/${b.version}/${b.mainfile}`;console.warn(`Can't find package for ${a.name}@${a.version}`)}else{let b=this.getPackageInfo(a.name)[0];return b?(a.version=b.lastversion,`${this.jsdelivr}/${b.name}/${b.lastversion}/${b.mainfile}`):(console.warn(`Can't find package for ${a.name}`),void 0)}}getPackageInfo(a){let b=`${this.apiBase}?name=${a}&fields=name,lastversion,mainfile`;return JSON.parse(this.httpsync(b))}getPackageVersion(a,b){let c=`${this.apiBase}?name=${a}&fields=name,assets`,d=JSON.parse(this.httpsync(c)),e=void 0;return 0<d.length&&d[0].assets.every((f,g)=>{return b!==f.version||(console.info(`Found matching version for ${d[0].name}@${f.version}`),e=f,e.name=d[0].name,!1)}),e}appendScript(filename){let pr=new Promise((resolve,reject)=>{filename&&eval(this.httpsync(filename)),resolve(filename)});return pr}httpsync(a){var b=new XMLHttpRequest;return b.open('GET',a,!1),b.send(''),b.responseText}callback(a,b){a()}windowLoaded(){console.info('On complete fired'),this.oncomplete&&eval(this.oncomplete)}}customElements.define('script-y',Scripty)})();